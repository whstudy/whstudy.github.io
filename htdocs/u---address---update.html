<html><!--@(window)--><!--@(document)--><head>
<meta charset="utf-8">
<meta http-equiv="Cache-Control" content="no-store">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>修改收货地址</title>

<link rel="shortcut icon" href="http://state.zhi-you.net/favicon.ico">
<link rel="stylesheet" href="css/common.css">
<link rel="stylesheet" href="css/components.css">
<link rel="stylesheet" href="css/custom.css">
<link rel="stylesheet" href="css/icon.css">
<link rel="stylesheet" href="plugin/font-awesome-4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="plugin/miui-1.0/jquery.miui.css">
<script src="plugin/jquery-1.11.0/jquery.min.js"></script>
<script src="plugin/layer-mobile-2.0/layer.js"></script><link href="http://state.zhi-you.net/plugin/layer-mobile-2.0/need/layer.css?2.0" type="text/css" rel="styleSheet" id="layermcss">
<script src="plugin/miui-1.0/jquery.miui.js"></script>
<script src="plugin/fastclick-1.0/fastclick.js "></script>
<script src="js/common.js"></script>
<script src="js/util.js"></script>
<script>
  var Config = {
    stc : '',
    ctx : '',
    stccdn : 'http://state.zhi-you.net'
  }
</script>




<script src="plugin/jquery-validation-1.15.0/jquery.validate.js"></script>
<script src="extend/jquery-validation/jquery.validate.method.js"></script>
<script>
  $.validator.setDefaults({
    ignore : '.ignore',
    ignoreTitle : true,
    errorContainer : '.form-message',
    errorClass : 'valid-error',
    errorElement : 'span',
    errorPlacement : function(error, element) {
      //messageFlash(error.text());
      if($('.form-message').length > 0){
        $('.form-message').html('<p>输入信息有误，请先更正。</p>').slideDown(300);
      }
      if ($(element).parents('.list-item').find('.form-error').length == 0) {
        var formError = $('<div class="form-error"><i class="fa fa-exclamation-circle"></i></div>');
        $(element).parents('.list-item').addClass('list-item-error').append(formError);
      }
    },
    success : function(error, element) {
      if ($(element).parents('.list-item').find('.valid-error').length == 0) {
        $(element).parents('.list-item').removeClass('list-item-error').find('.form-error').remove();
      }
    },
    submitHandler : function(form) {
      $(form).find(':submit').prop('disabled', true);
      form.submit();
    }
  });
</script>
<script src="js/area.js"></script>
</head>
<body>
  <header class="header">
    <h1>修改收货地址</h1>
    <a href="#" onclick="history.go(-1);" class="button-left"><i class="fa fa-angle-left"></i></a>
    <a href="javascript:;" id="btnDelete" class="button-right"><i class="fa fa-trash"></i></a>
  </header>
  <article class="address-edit">
    <form id="addressForm" class="valid-form" action="/u---address---edit" method="post" novalidate="novalidate">
      <input type="hidden" id="id" name="id" value="">
      <div class="form-message note note-warning mb-0 hide">
        <p>输入信息有误，请先更正。</p>
      </div>
      <div class="list-group">
        <div class="list-item">
          <label class="list-label" for="deliveryMan">收件人</label>
          <div class="list-text">
            <input type="text" id="deliveryMan" name="deliveryMan" class="form-input" value="付铠博" placeholder="填写收件人姓名">
          </div>
        </div>
        <div class="list-item">
          <label class="list-label" for="phone">手机号码</label>
          <div class="list-text">
            <input type="tel" id="phone" name="phone" class="form-input" value="13120576767" placeholder="填写收件人手机号码">
          </div>
        </div>
        <div class="list-item">
          <label class="list-label">省份</label>
          <div class="list-text form-select">
            <select name="province" id="province">
              <option value="">请选择</option>
            <option data-id="1" value="1">北京市</option><option data-id="20" value="20">天津市</option><option data-id="39" value="39">河北省</option><option data-id="233" value="233">山西省</option><option data-id="375" value="375">内蒙古自治区</option><option data-id="499" value="499">辽宁省</option><option data-id="628" value="628">吉林省</option><option data-id="706" value="706">黑龙江省</option><option data-id="860" value="860">上海市</option><option data-id="880" value="880">江苏省</option><option data-id="1006" value="1006">浙江省</option><option data-id="1119" value="1119">安徽省</option><option data-id="1257" value="1257">福建省</option><option data-id="1361" value="1361">江西省</option><option data-id="1484" value="1484">山东省</option><option data-id="1656" value="1656">河南省</option><option data-id="1851" value="1851">湖北省</option><option data-id="1981" value="1981">湖南省</option><option data-id="2131" value="2131">广东省</option><option data-id="2292" value="2292">广西壮族自治区</option><option data-id="2431" value="2431">海南省</option><option data-id="2462" value="2462">重庆市</option><option data-id="2503" value="2503">四川省</option><option data-id="2726" value="2726">贵州省</option><option data-id="2829" value="2829">云南省</option><option data-id="2983" value="2983">西藏自治区</option><option data-id="3066" value="3066">陕西省</option><option data-id="3194" value="3194">甘肃省</option><option data-id="3307" value="3307">青海省</option><option data-id="3360" value="3360">宁夏回族自治区</option><option data-id="3393" value="3393">新疆维吾尔自治区</option><option data-id="3510" value="3510">台湾省</option><option data-id="3511" value="3511">香港特别行政区</option><option data-id="3512" value="3512">澳门特别行政区</option></select>
          </div>
        </div>
        <div class="list-item">
          <label class="list-label">城市</label>
          <div class="list-text form-select">
            <select name="city" id="city">
              <option value="">请选择</option>
            <option data-id="1_2" value="2">市辖区</option><option data-id="1_17" value="17">县</option></select>
          </div>
        </div>
        <div class="list-item">
          <label class="list-label">地区</label>
          <div class="list-text form-select">
            <select name="region" id="region">
              <option value="">请选择</option>
            <option data-id="1_2_3" value="3">东城区</option><option data-id="1_2_4" value="4">西城区</option><option data-id="1_2_5" value="5">朝阳区</option><option data-id="1_2_6" value="6">丰台区</option><option data-id="1_2_7" value="7">石景山区</option><option data-id="1_2_8" value="8">海淀区</option><option data-id="1_2_9" value="9">门头沟区</option><option data-id="1_2_10" value="10">房山区</option><option data-id="1_2_11" value="11">通州区</option><option data-id="1_2_12" value="12">顺义区</option><option data-id="1_2_13" value="13">昌平区</option><option data-id="1_2_14" value="14">大兴区</option><option data-id="1_2_15" value="15">怀柔区</option><option data-id="1_2_16" value="16">平谷区</option></select>
          </div>
        </div>
        <div class="list-item">
          <div class="list-text">
            <textarea id="detailed" name="detailed" class="form-input" rows="3" placeholder="填写详细地址，例如街道名称，楼层和门牌号等信息">中关村 大恒科技大厦</textarea>
          </div>
        </div>
        <div class="list-item">
          <div class="list-text">设为默认地址</div>
          <div class="list-unit form-switch">
            <input type="hidden" name="_isDefault" value="false">
            <input type="checkbox" id="isDefault" name="isDefault">
            <label class="i-switch" for="isDefault"></label>
          </div>
        </div>
      </div>

      <div class="form-btn">
        <input id="btnSubmit" class="btn orange btn-block round-2" type="button" href="#" value="保 存">
      </div>
    </form>
  </article>

  <script type="text/javascript">

    var region = '8';
    var area = new areaInit('province', 'city', 'region', region/* , defaultregion */);


    var addressInfo=JSON.parse(sessionStorage.getItem('addressInfo'));
    for(var o in addressInfo){
      $("#"+o).val(addressInfo[o]);
      $("#"+o).change();
    }
    if(addressInfo.isDefault=="true"){
      $('#isDefault').click();
    }

    $('.valid-form').validate({
      rules : {
        'deliveryMan' : {
          required : true
        },
        'phone' : {
          required : true,
          phone : true
        },
        'province' : {
          required : true
        },
        'city' : {
          required : true
        },
        'region' : {
          required : true
        },
        'detailed' : {
          required : true
        }
      },
      messages : {
        'deliveryMan' : {
          required : '请输入收货人姓名'
        },
        'phone' : {
          required : '请输入收货人手机号',
          phone : '请输入正确的手机号'
        },
        'province' : {
          required : '请选择省'
        },
        'city' : {
          required : '请选择市'
        },
        'region' : {
          required : '请选择区'
        },
        'detailed' : {
          required : '请输入详细地址'
        }
      }
    });

    $('#btnDelete').click(function() {
      $.dialog({
        content : '您确认要删除该收货地址吗?',
        callback : function(index){
          if(index == 1) {
            location.href = '/u---address---delete/update';
            return true;
          }
        }
      });
    });

    $('#isDefault').click(function() {
      $(this).val($(this).is(':checked'));
    });

    $('#btnSubmit').click(function(){
      if(!$('.valid-form').valid()){
        return;
      }

      var data=$('.valid-form').serializeArray();
      data.push({name:'isDefault',value:$('#isDefault').val()});

      $.ajax({
        url: serviceUrl+'/api/user/updateDeliverAddress',
        type: 'POST',
        // dataType: 'json',
        xhrFields: {
          withCredentials:true
        },
        data: data,
        success: function(data){
          console.log("success");
          console.log(data);
          history.go(-1);
        }
      })
      // .done(function(data) {

      // })
      // .fail(function(data) {
      //   console.log("error");
      // })
      // .always(function() {
      //   console.log("complete");
      // });
      
    })

  </script>

</body></html>